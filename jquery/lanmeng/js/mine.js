/*! loongjoy 2017-03-20 */
$("html, body").css("scrollTop",0),function(){var a=$("#j_sld_focus"),b=$("#j_sld_focus ul"),c=b.children(),d=a.attr("data-min"),e=c.length,f=0;if(d>=e)return void a.find(".next, .prev").hide();for(var g=0;d>g;g++)c.eq(g).clone().appendTo(b);a.on("click",".prev",function(a){b.is(":animated")||(--f<0&&(f=e-1,b.css({left:-e/d*100+"%"})),b.animate({left:"+="+100/d+"%"},400))}).on("click",".next",function(a){b.is(":animated")||(++f>=e&&(f=0,b.css({left:0})),b.animate({left:"-="+100/d+"%"},400))})}(),function(){function a(b){a.$load||(a.$load=$('<div class="uc-load">').appendTo("body"));var c=a.$load,d=$.Deferred();return c.addClass("show"),b.done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}).always(function(){c.removeClass("show")}),d.promise()}var b=["/store/list?keyword=","/innovate/example-list?keyword=","/bbs/search.php?mod=forum&searchsubmit=yes&srchtxt=","/infor/list/4?keyword="],c=$("#j_uc_header .search-tab"),d=$("#j_uc_header .search-ipt");$("#j_uc_header .search-btn");c.click(function(){$(this).addClass("active").siblings(".search-tab").removeClass("active")}),$("#j_uc_header .search form").submit(function(){return window.open(b[$("#j_uc_header .search-tab.active").index()]+d.val()),!1}),$(document).on("change",".j_province",function(a,b,c){var d=$(this).val(),e=this;return""===d?($(e).siblings(".j_city").html('<option value="">--选择市--</option>'),void $(e).siblings(".j_district").html('<option value="">--选择区--</option>')):void $.get("/user/api/city?id="+d).success(function(a){var d='<option value="">--选择市--</option>';$.each(a,function(){d+='<option value="'+this.id+'">'+this.name+"</option>"}),$(e).siblings(".j_city").html(d).siblings(".j_district").html('<option value="">--选择区--</option>'),b&&$(e).siblings(".j_city").val(b),c&&$(e).siblings(".j_city").trigger("change",c)})}).on("change",".j_city",function(a,b){var c=this,d=$(this).val();return""===d?void $(c).siblings(".j_district").html('<option value="">--选择区--</option>'):void $.get("/user/api/city?id="+d).success(function(a){var d='<option value="">--选择区--</option>';$.each(a,function(){d+='<option value="'+this.id+'">'+this.name+"</option>"}),$(c).siblings(".j_district").html(d),b&&$(c).siblings(".j_district").val(b),0===a.length&&$(c).siblings(".j_district").val("")})}),window.load=a}(),function(){var a=$("#j_uc_address");if(a.length){var b=$("#j_modal1");$("#j_modal2"),$("#j_modal3");a.on("click",".uc-address-body .btn-new",function(){var c=a.find(".alist .item").length;return c>=5?alertTips("最多只能创建5个收货地址"):(b.find("form").get(0).reset(),b.find('form [name="id"]').val(""),b.find(".modal-header").text("新增收货人"),b.find("div.help").html(""),b.find(".error").removeClass("error"),void b.modal("show"))}).on("click",".uc-address-body .btn-edit",function(){var a=$(this).parents(".item");b.find("form").get(0).reset(),b.find(".modal-header").text("编辑收货人").end().find('[name="id"]').val(a.attr("data-id")).end().find('[name="consignee"]').val(a.attr("data-consignee")).end().find('[name="province"]').val(a.attr("data-province")).trigger("change",[a.attr("data-city"),a.attr("data-district")]).end().find('[name="address"]').val(a.attr("data-address")).end().find('[name="zipcode"]').val(a.attr("data-zipcode")).end().find('[name="mobile"]').val(a.attr("data-mobile")).end().find('[name="phone"]').val(a.attr("data-phone")).end().modal("show"),b.find("div.help").html(""),b.find(".error").removeClass("error"),b.modal("show")}).on("click",".uc-address-body .btn-del",function(){if(confirm("确定要删除该条地址吗？")){var a=$(this).parents(".item").attr("data-id"),b=$(this).parents(".item");load($.post("/user/api/deladdress",{id:a})).done(function(a){0===a.status?b.remove():alertTips(a.tips)})}}).on("click",".uc-address-body .btn-dft",function(){var a=$(this).parents(".item");a.hasClass("active")||confirm("要将该条地址设置为默认吗？")&&load($.post("/user/api/setdefaultaddress",{id:a.attr("data-id")})).done(function(b){0===b.status?a.addClass("active").siblings(".item").removeClass("active"):alertTips(b.tips)})}),$.validator.addMethod("regex",function(a,b,c){var d=new RegExp(c);return this.optional(b)||d.test(a)},"Please check your input."),$("form",b).validate({rules:{consignee:{required:!0},province:{required:!0,number:!0},city:{required:!0,number:!0},district:{required:!1,number:!1},address:{required:!0},zipcode:{required:!0,regex:"^\\d{6}"},mobile:{required:!0,regex:"^13[\\d]{9}$|^14[5,7]{1}\\d{8}$|^15[^4]{1}\\d{8}$|^17[0,6,7,8]{1}\\d{8}$|^18[\\d]{9}$"},phone:{regex:"^([0-9]{3,4}-)?[0-9]{7,8}$"}},messages:{consignee:"收货人不能为空",province:"请选择省&ensp;",city:"请选择市&ensp;",district:"请选择区&ensp;",address:"详细地址不能为空",zipcode:{required:"邮编不能为空",regex:"请输入正确的邮编"},mobile:{required:"手机号不能为空",regex:"请输入正确的手机号"},phone:{regex:"固话格式错误"}},errorElement:"span",errorPlacement:function(a,b){b.parents("td").find(".help").append(a)},submitHandler:function(a){load($.post($(a).find('[name="id"]').val()?"/user/api/modifyaddress":"/user/api/addaddress",$(a).serialize())).done(function(a){0===a.status?window.location.reload():alertTips(a.tips)})}})}}(),function(){var a=$("#j_uc_auth");if(a.length){var b=$("#authform");b.find('[name="groupType"]').on("change",function(){switch(b.find(".type1, .type2, .type3").removeClass("show"),$(this).val()){case"6":b.find(".type1").addClass("show");break;case"7":b.find(".type2").addClass("show");break;case"8":b.find(".type3").addClass("show")}}),b.validate({groups:{area:"province city"},rules:{groupType:{required:!0},bid:{required:!0},company:{required:!0},mobile:{required:!0},netcode:{required:!0},province:{required:!0},city:{required:!0},address:{required:!0},type:{required:!0},rank:{required:!0,number:!0},taxnum:{required:!0},bank:{required:!0},account:{required:!0}},messages:{groupType:{required:"认证类型不能为空"},bid:{required:"品牌不能为空"},company:{required:"公司名称不能为空"},netcode:{required:"网络代码不能为空"},mobile:{required:"公司固定电话不能为空"},province:{required:"请选择省"},city:{required:"请选择市"},address:{required:"详细地址不能空"},type:{required:"请选择公司类别"},rank:{required:"展厅级别不能为空",number:"展厅级别为数字"},taxnum:{required:"税务登记号不能为空"},bank:{required:"开户行账号不能为空"},account:{required:"开户账号不能为空"}},errorElement:"span",errorPlacement:function(a,b){b.parents(".uc-auth1-cont").find(".help").append(a)},submitHandler:function(a){load($.post("/user/api/applyauth",$(a).serialize())).done(function(a){0===a.status?window.location.reload():alert(a.tips)})}}),$(".uc-auth2 .upload-btn").each(function(){var a=$(this),b=a.siblings(".upload-info").find(".prog"),c=b.find(".in"),d=b.find(".pct"),e=a.siblings(".upload-info").find(".msg"),f=a.siblings(".preview").find(".pre img");new ss.SimpleUpload({button:a,url:"/image/upload",name:"file",maxSize:1024,multipart:!0,disabledClass:"disabled",allowedExtensions:["jpg","jpeg","png","gif"],responseType:"json",onExtError:function(a,b){e.text("文件格式不支持").show()},onSizeError:function(a,b){e.text("文件不能超过1M").show()},onSubmit:function(){this.disable(),a.text("上传中"),b.show(),this.setProgressBar(c),this.setPctBox(d),a.siblings(".upload-info").find(".msg").hide()},onError:function(){this.enable(),a.text("选择文件"),b.hide(),e.text("请求失败，请重试").show()},onComplete:function(c,d,g,h){this.enable(),a.text("选择文件"),b.hide(),0===d.status?(f.attr("src","/image/get/"+d.content.imageId),a.attr("data-id",d.content.imageId)):e.text(d.tips).show()}})}),$("#btn2Prev").click(function(){$(".uc-auth2").removeClass("active"),$(".uc-auth1").addClass("active")}),$("#btn2Submit").click(function(){var a={},b={clicense:"营业执照",ctax:"税务登记",ocode:"组织机构代码"},c=null;return $(".uc-auth2 .upload-btn").each(function(){var d=$(this).attr("data-type"),e=$(this).attr("data-id");a[d]=e,e||c||(c="请上传"+b[d]+"图片")}),c?void alert(c):(a.userInfoId=$("#userInfoId").val(),void load($.post("/user/api/updateauth",a)).done(function(a){0===a.status?window.location.reload():alert(a.tips)}))})}}(),function(){var a=$("#j_uc_comment");a.length&&a.on("click",".cmt-title .toggle",function(){var a=$(this).parents(".cmt-title").siblings(".cmt-cont"),b=["[收起]","[查看]"];$(this).text()==b[0]?($(this).text(b[1]),a.slideUp(200)):($(this).text(b[0]),a.slideDown(200))})}(),function(){if($("#j_comment").length){var a=$("#j_comment"),b=$("#j_comment .cmt-help");a.validate({rules:{username:{required:!0},linktype:{required:!0},company:{required:!0},email:{required:!0,email:!0},content:{required:!0}},messages:{username:"姓名不能为空",linktype:"联系方式不能为空",company:"公司不能为空",email:{required:"电子邮箱不能为空",email:"邮箱地址不正确"},content:"留言内容不能为空"},errorElement:"div",errorPlacement:function(a,c){b.append(a)},submitHandler:function(a){load($.post("/user/api/message",$(a).serialize())).done(function(a){0===a.status?location.href="/mine/comment":alert(a.tips)})}})}}(),function(){function a(a){load($.post("/user/api/cancelfollow",a)).done(function(a){0===a.status?window.location.reload():alert(a.tips)})}var b=$("#j_uc_focus");b.length&&($(".uc-focus-body .cancelBtn").on("click",function(){var b=$(this).parents(".item").find(":checkbox"),c={group:{}};c.group[b.attr("data-type")]=[b.val()],confirm("确定要取消关注该条商品吗？")&&a(c)}),$(".uc-focus-body .operate a").on("click",function(){var b={group:{}},c=$(".uc-focus-body .goods :checked").map(function(){return{id:$(this).val(),type:$(this).attr("data-type")}}).toArray();return c.length?($.each(c,function(){b.group[this.type]||(b.group[this.type]=[]),b.group[this.type].push(this.id)}),void(confirm("确定要取消关注选中的商品吗？")&&a(b))):alert("请先选中需要批量删除的商品")}),$(".uc-focus-body .operate input").on("change",function(){$(".uc-focus-body .goods :checkbox").prop("checked",$(this).is(":checked"))}))}(),function(){$(".group").on("click",".apply",function(a){var b=$(this).parent("td").siblings("td").html(),c=$(this).parent("td").siblings("input").val();alertTips("是否绑定，"+b+"集团？","applyBind","确定",c)}).on("click",".apply-con .look",function(a){var b=$('input[name="apply-group"]').val(),c=$('input[name="apply-group"]').attr("data-id");alertTips(b+"，对您发出了绑定邀请，是否接受？","inviteBind","接受",c)});var a=$(".uc-main-main.group .con").height();584>a&&$(".uc-main-main.group .con").height(584)}(),function(){var a=$("#j_uc_grow_record");if(a.length){var b=$("#j_startDate"),c=$("#j_endDate");a.find(".uc-score-body .filter .side .ubtn").click(function(){var a=b.val(),d=c.val();a&&d?window.location.href=$(this).attr("data-url").replace("{start}",a).replace("{end}",d):a||d||(window.location.href="/mine/grow/record")})}}(),function(){var a=$("#j_uc_invoice");if(a.length){var b=a.find("form");b.validate({groups:{area:"province city dist"},rules:{company:{required:!0},phone:{required:!0,pattern:"^([0-9]{3,4}-)?[0-9]{7,8}$"},taxnum:{required:!0},bank:{required:!0},address:{required:!0},account:{required:!0},username:{required:!0},mobile:{required:!0,pattern:"^1[0-9]{10}$"},province:{required:!0},city:{required:!0},dist:{required:!1},adddress:{required:!0}},messages:{company:"公司地址不能为空",phone:{required:"公司电话不能为空",pattern:"电话号码格式错误"},taxnum:"纳税人识别码不能为空",bank:"开户行不能为空",address:"公司地址不能为空",account:"银行账号不能为空",username:"收票人不能为空",mobile:{required:"收票人手机不能为空",pattern:"手机号码格式错误"},adddress:"详细地址不能为空",province:"请选择省市区",city:"请选择省市区",dist:"请选择省市区"},errorElement:"div",errorPlacement:function(a,b){$(b).parents("td").find(".help").append(a)},submitHandler:function(a){var b=$(a).find("#id").val();load($.post("/user/api/"+(b?"modifyinvoice":"invoice"),$(a).serialize())).done(function(a){0===a.status?littleTips("保存成功"):littleTips(a.tips)})}})}}(),function(){var a=$("#j_uc_user");a.length&&a.find(".u3 .panel .sign").on("click",function(a){$(this).hasClass("disabled")||load($.get("user/api/sign")).done(function(a){0===a.status?window.location.reload():alert(a.tips)})})}(),function(){var a=$("#j_uc_order");a.length&&a.on("click",".uc-order-header .del",function(){return confirm("确定要删除该条订单信息吗？")?void 0:!1})}(),function(){var a=$("#j_uc_order2");a.length&&a.on("click",".uc-order-header .del",function(){var a=$(this).parents("tbody").attr("data-id");$.post("/user/api/foo",{id:a}).success(function(a){littleTips(a.tips),0===a.status&&window.location.reload()})})}(),function(){function a(a){var b=$.Deferred();$.isNumeric(a)&&0>=a&&b.reject(),b.notify(a);var c=setInterval(function(){b.notify(--a),0>=a&&(clearInterval(c),b.resolve(a))},1e3);return b}var b=$("#j_uc_phone");if(b.length){var c=b.find("form").validate({rules:{mobile:{required:!0,pattern:"^1\\d{10}$"},password:{required:!0,rangelength:[6,16]},code:{required:!0}},messages:{mobile:{required:"手机号不能为空",pattern:"手机号码格式错误"},password:{required:"密码不能为空",rangelength:"密码长度介于6-16位之间"},code:"验证码不能为空"},errorElement:"span",errorPlacement:function(a,b){b.next().append(a)},submitHandler:function(a){load($.post("/user/api/modifymobile",$(a).serialize())).done(function(c){0===c.status?(b.find(".uc-phone-body .w-step-item").addClass("on"),$(a).hide().siblings(".result").show()):alertTips(c.tips)})}}),d=$("#captchaBtn"),e=($("#captcha"),$("#mobile"));d.on("click",function(){var b=e.val(),f=d.html();if($(this).hasClass("disabled"))return!1;if(e.hasClass("valid")){var g=$.Deferred();d.addClass("disabled"),d.siblings(".help").html(""),$.post("/user/api/validatecode",{mobile:b}).done(function(a){1===a.status&&g.resolve(a.tips)}).fail(function(a){g.resolve("请求失败，请重试")}),a(60).progress(function(a){g.notify(a)}).always(function(){g.resolve()}),$.when(g).progress(function(a){d.html("重新获取("+a+")")}).done(function(a){a&&d.siblings(".help").html(a),d.removeClass("disabled").html(f)})}else c.element(e),e.focus()})}}(),function(){function a(a){var b=0,c=.3,d=a.length,e=a.match(/\d/g),f=a.match(/[a-z]/g),g=a.match(/[A-Z]/g),h=a.match(/[!@#$%^&*?_~]/g);return e=e?e.length:0,f=f?f.length:0,g=g?g.length:0,h=h?h.length:0,d>8&&(b+=c),d>12&&(b+=c),e>0&&(b+=c),e>2&&(b+=c),f>0&&(b+=c),f>2&&(b+=c),g>0&&(b+=c),g>2&&(b+=c),h>0&&(b+=c),h>2&&(b+=c),Math.floor(b)}var b=$("#j_uc_pwd form");if(b.length){$("#j_uc_pwd .submit");b.validate({errorElement:"span",rules:{oldPwd:{required:!0,rangelength:[6,16]},newPwd:{required:!0,rangelength:[6,16]},reNewPwd:{required:!0,equalTo:"#newPwd"}},messages:{oldPwd:{required:"原始密码不能为空",rangelength:"密码长度介于6位至16位之间"},newPwd:{required:"新密码不能为空",rangelength:"密码长度介于6位至16位之间"},reNewPwd:{required:"确认新密码不能为空",equalTo:"两次密码必须一致"}},errorPlacement:function(a,b){b.parents(".uc-pwd-row").find(".help").append(a)},submitHandler:function(a){load($.post("/user/api/modifypass",$(a).serialize())).done(function(a){0===a.status?window.location.href="/login":alert(a.tips)})}});var c=$("#j_pwd_strength");$("#newPwd").on("keyup",function(){var b=["lv-low","lv-mid","lv-high"],d=a($(this).val());c.removeClass(b.join(" ")).addClass(b[d])})}}(),function(){var a=$("#j_uc_score");if(a.length){var b=$("#j_startDate"),c=$("#j_endDate");$("#search").on("submit",function(){return b.val()&&c.val()?void 0:(alert("请选择筛选范围"),!1)})}}(),function(){function a(a){return a=String(a),a.length<2?"0"+a:a}var b=$("#j_uc_setting");if(b.length){var c=b.find(".year"),d=b.find(".month"),e=b.find(".day"),f=e.val();e.on("change",function(){f=$(this).val()}),c.add(d).on("change",function(){var a=c.val(),b=d.val();if(a&&b){var g=new Date(a,b,0).getDate(),h='<option value="">日</option>';$.each(new Array(g),function(a){h+='<option value="'+(a+1)+'">'+(a+1)+"</option>"}),e.html(h),f&&g>=f&&e.val(f)}});var g=b.find("form.uif");g.validate({groups:{brith:"year month day"},rules:{nickname:{required:!0,rangelength:[2,10]},year:{required:!0,number:!0},month:{required:!0,number:!0},day:{required:!0,number:!0},email:{required:!0,email:!0},qq:{required:!0,pattern:"^\\d{5,10}$"}},messages:{nickname:{required:"用户名不能为空",rangelength:"用户名介于2-10位之间"},year:"请选择出生日期",month:"请选择出生日期",day:"请选择出生日期",email:{required:"邮箱地址不能为空",email:"邮箱地址格式错误"},qq:"QQ号码格式错误"},errorElement:"span",errorPlacement:function(a,b){var c=$(b).attr("name");"year"===c||"month"===c||"day"===c?$(b).parent().append(a):$(b).after(a)},submitHandler:function(b){var c=$(b).serializeArray();b.year.value&&b.month.value&&b.day.value?c.push({name:"brith",value:b.year.value+"-"+a(b.month.value)+"-"+a(b.day.value)}):c.push({name:"brith",value:""}),load($.post("/user/api/modifyinfo",$.param(c))).done(function(a){0===a.status?window.location.reload():alertTips(a.tips)})}})}}(),function(){var a=$("#j_uc_uicon");if(a.length){var b=$("#uploadBtn"),c=b.siblings(".upload-info").find(".prog"),d=c.find(".in"),e=c.find(".pct"),f=b.siblings(".upload-info").find(".msg"),g=b.siblings(".preview").find("img");new ss.SimpleUpload({button:b,url:"/image/upload",name:"file",maxSize:2048,multipart:!0,disabledClass:"disabled",allowedExtensions:["jpg","jpeg","png","gif"],responseType:"json",onExtError:function(a,b){f.text("文件格式不支持").show()},onSizeError:function(a,b){f.text("文件不能超过2M").show()},onSubmit:function(){this.disable(),c.show(),this.setProgressBar(d),this.setPctBox(e),b.siblings(".upload-info").find(".msg").hide()},onError:function(){this.enable(),c.hide(),f.text("请求失败，请重试").show()},onComplete:function(a,d,e,h){this.enable(),c.hide(),0===d.status?(g.attr("src","/image/get/"+d.content.imageId),b.attr("data-id",d.content.imageId)):f.text(d.tips).show()}}),$("#submitBtn").click(function(){var a=b.attr("data-id");return a?(load($.post("/user/api/avatar",{imageId:a})).done(function(a){0===a.status?window.location.reload():alertTips(a.tips)}),!1):(alertTips("请先上传图片"),!1)})}}();